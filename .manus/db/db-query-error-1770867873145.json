{
  "query": "-- Weight Tracking RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own weight tracking records\" ON public.weight_tracking FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own weight tracking records\" ON public.weight_tracking FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own weight tracking records\" ON public.weight_tracking FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own weight tracking records\" ON public.weight_tracking FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Products RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own products\" ON public.products FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own products\" ON public.products FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own products\" ON public.products FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own products\" ON public.products FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Shop Orders RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own shop orders\" ON public.shop_orders FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own shop orders\" ON public.shop_orders FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own shop orders\" ON public.shop_orders FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Aftercare Records RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own aftercare records\" ON public.aftercare_records FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own aftercare records\" ON public.aftercare_records FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own aftercare records\" ON public.aftercare_records FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Member Levels RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own member levels\" ON public.member_levels FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own member levels\" ON public.member_levels FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own member levels\" ON public.member_levels FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Coupons RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own coupons\" ON public.coupons FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own coupons\" ON public.coupons FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own coupons\" ON public.coupons FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Coupon Usage RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own coupon usage\" ON public.coupon_usage FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own coupon usage\" ON public.coupon_usage FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Referrals RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own referrals\" ON public.referrals FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own referrals\" ON public.referrals FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own referrals\" ON public.referrals FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Member Promos RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own member promos\" ON public.member_promos FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own member promos\" ON public.member_promos FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own member promos\" ON public.member_promos FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Payment Methods RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own payment methods\" ON public.payment_methods FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own payment methods\" ON public.payment_methods FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own payment methods\" ON public.payment_methods FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Customer Tags RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own customer tags\" ON public.customer_tags FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own customer tags\" ON public.customer_tags FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own customer tags\" ON public.customer_tags FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Error Logs RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own error logs\" ON public.error_logs FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint OR current_setting('app.user_role', true) = 'super_admin');\nCREATE POLICY IF NOT EXISTS \"System can insert error logs\" ON public.error_logs FOR INSERT WITH CHECK (true);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3yhrFTMwYTaZZBj.e200c1c625b3 --database AAVvDnQSgZb2QX3g6gP92w --execute -- Weight Tracking RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own weight tracking records\" ON public.weight_tracking FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own weight tracking records\" ON public.weight_tracking FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own weight tracking records\" ON public.weight_tracking FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own weight tracking records\" ON public.weight_tracking FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Products RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own products\" ON public.products FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own products\" ON public.products FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own products\" ON public.products FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own products\" ON public.products FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Shop Orders RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own shop orders\" ON public.shop_orders FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own shop orders\" ON public.shop_orders FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own shop orders\" ON public.shop_orders FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Aftercare Records RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own aftercare records\" ON public.aftercare_records FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own aftercare records\" ON public.aftercare_records FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own aftercare records\" ON public.aftercare_records FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Member Levels RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own member levels\" ON public.member_levels FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own member levels\" ON public.member_levels FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own member levels\" ON public.member_levels FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Coupons RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own coupons\" ON public.coupons FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own coupons\" ON public.coupons FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own coupons\" ON public.coupons FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Coupon Usage RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own coupon usage\" ON public.coupon_usage FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own coupon usage\" ON public.coupon_usage FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Referrals RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own referrals\" ON public.referrals FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own referrals\" ON public.referrals FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own referrals\" ON public.referrals FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Member Promos RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own member promos\" ON public.member_promos FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own member promos\" ON public.member_promos FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own member promos\" ON public.member_promos FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Payment Methods RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own payment methods\" ON public.payment_methods FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own payment methods\" ON public.payment_methods FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can update their own payment methods\" ON public.payment_methods FOR UPDATE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Customer Tags RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own customer tags\" ON public.customer_tags FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can insert their own customer tags\" ON public.customer_tags FOR INSERT WITH CHECK (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\nCREATE POLICY IF NOT EXISTS \"Tenants can delete their own customer tags\" ON public.customer_tags FOR DELETE USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint);\n\n-- Error Logs RLS\nCREATE POLICY IF NOT EXISTS \"Tenants can view their own error logs\" ON public.error_logs FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint OR current_setting('app.user_role', true) = 'super_admin');\nCREATE POLICY IF NOT EXISTS \"System can insert error logs\" ON public.error_logs FOR INSERT WITH CHECK (true);",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 2: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 1 column 13 near \"POLICY IF NOT EXISTS \"Tenants can view their own weight tracking records\" ON public.weight_tracking FOR SELECT USING (tenant_id = current_setting('app.current_tenant_id', true)::bigint)\""
  ]
}